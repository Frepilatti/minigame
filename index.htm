<!DOCTYPE html>

<html>

<head>

    <meta charset="utf-8"/>
    <title>Minigame - Frederico</title>
    <style>
        
        canvas {
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            margin: auto;

        }
    </style>

</head>

<body>

    <script>
        // Game variables
        var canvas, 
            context, 
            gameHeight, 
            gameWidth, 
            frames = 0, 
            maxJump = 3, 
            obstacleSpeed = 6,

        ground = {
            y: 550,
            groundHeight: 50,
            groundColor: "#ffdf70",

            drawGround: function(){
                context.fillStyle = this.groundColor;
                context.fillRect(0, this.y, gameWidth, this.groundHeight)
            }
        },// End of variable ground

        player = {
            x:50,
            y:0,
            playerHeight: 50,
            playerWidth:50,
            playerColor: "#ff4e4e",
            gravity: 1.6,
            speed: 0,
            jumpSpeed: 23.6,
            jumps: 0,

            drawPlayer: function() {
                context.fillStyle = this.playerColor;
                context.fillRect(this.x, this.y, this.playerWidth, this.playerHeight);
            },
            playerMovement: function() {
                this.speed += this.gravity;
                this.y += this.speed;

                if(this.y > ground.y - this.playerHeight) {
                    this.y = ground.y - this.playerHeight;
                    this.jumps =0;
                }
            },

            jump: function(){
                if(this.jumps < maxJump){
                    this.speed = - this.jumpSpeed;
                    this.jumps++;
                }
            }
        },// End of variable player

        obstacle = {
            _obs: [],
            obstacleColors: ["#a0ff1c", "#ffbc1c", "#ff1c1c", "#ff85e1", "#ce3fdc", "#78ff5d"],
            insertTime: 0,

            insertObstacle: function(){
                this._obs.push({
                    x: gameWidth,
                    obstacleWidth: 30 + Math.floor(21 * Math.random()),
                    obstacleHeigth: 30 + Math.floor(120*Math.random()),
                    obstacleColor: this.obstacleColors[Math.floor(6 * Math.random())]
                });
                this.insertTime = 30 + Math.floor(21 * Math.random());
            },
            updtObstacle: function(){
                if (this.insertTime == 0){
                    this.insertObstacle();
                }
                else{
                    this.insertTime--;
                }

                for(var i = 0,  size = this._obs.length; i < size; i++) {
                    var obs = this._obs[i];

                    obs.x -= obstacleSpeed;

                    if (obs.x <= -obs.obstacleWidth) {
                        this._obs.splice(i, 1);
                        size--;
                        i--;
                    }
                }
            },
            drawObstacle: function(){
                for(var i = 0, size = this._obs.length; i < size; i++){
                    var obs = this._obs[i];
                    context.fillStyle = obs.obstacleColor;
                    context.fillRect(obs.x, ground.y - obs.obstacleHeigth, obs.obstacleWidth, obs.obstacleHeigth);

                }
            }
        };// End of variable obstacle

        function onClick(event){

            player.jump();

        }
        
        function main(){

            gameHeight = window.innerHeight;
            gameWidth = window.innerWidth;

            if (gameWidth >= 600){

                gameWidth = 600;
                gameHeight = 600;

            }

            canvas = document.createElement("canvas");

            canvas.width = gameWidth;

            canvas.height = gameHeight;

            canvas.style.border = "1px solid #000";

            context = canvas.getContext("2d");

            document.body.appendChild(canvas);

            document.addEventListener("mousedown", onClick);

            runGame();
        }

        function runGame(){

            updtStats();
            draw();

            window.requestAnimationFrame(runGame);

        }

        function updtStats(){

            frames++;

            player.playerMovement();
            obstacle.updtObstacle();
        }

        function draw(){

            context.fillStyle = "#50beff";
            context.fillRect(0, 0, gameHeight, gameWidth);

            ground.drawGround();
            obstacle.drawObstacle();
            player.drawPlayer();


        }
            
        main();
    </script>

</body>

</html>